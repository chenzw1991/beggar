<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:mo="https://gitee.com/aun/Timo">
<head th:replace="/common/template :: header(~{::title},~{::link},~{::style})">
</head>
<body class="timo-layout-page">
<div class="layui-card">
    <div class="layui-card-header timo-card-header">
        <span><i class="fa fa-bars"></i> 反馈类型</span>
        <i class="layui-icon layui-icon-refresh refresh-btn"></i>
    </div>
    <div class="layui-card-body">
        <div class="layui-row timo-card-screen">
            <div class="pull-left layui-form-pane timo-search-box">
                <div class="layui-inline">
                    <a class="layui-btn open-popup" data-title="新增反馈类型" th:attr="data-url=@{'/feedback/typeedit/0'}"  data-size="600,330" href="javascript:;">新增</a>
                </div>
            </div>
        </div>
        <div class="timo-table-wrap">
            <table class="layui-table timo-table timo-table-fixed">
                <thead>
                <tr>
                    <th>反馈类型名称</th>
                    <th>是否启用</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item:${list}">
                    <td th:text="${item.names}"></td>
                    <td th:text="${#dicts.keyValue('YESNO_STATUS', item.status)}"></td>
                    <td>
                        <a class="open-popup" data-title="编辑反馈类型" th:attr="data-url=@{'/feedback/typeedit/'+${item.id}}"  data-size="600,330" href="javascript:;">编辑</a>
                        <a href="javascript:void(0)" th:onclick="'changeStatus('+${item.id}+','+${item.status}+')'" th:text="${item.status==0}?'启用':'停用'"></a>
                        <a href="javascript:void(0)" th:onclick= "'dataDelete('+${item.id}+')'">删除</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div th:replace="/common/fragment :: page"></div>
    </div>
</div>
<script th:replace="/common/template :: script"></script>
<script type="text/javascript" th:src="@{/js/plugins/jquery-3.3.1.min.js}"></script>
<script>
    var url = "[[@{/feedback/typedel}]]";
    function dataDelete(id) {
        if (!confirm("确定删除吗？"))
            return false;
        $.ajax({
            url		: url,
            data	: {"id":id},
            type	: "post",
            dataType: "json",
            success: function (res) {
                console.log(res);
                if(res.code == 200){
                    window.location.reload();
                }else{
                    alert(res.msg);
                }
            }
        });
    }
    function changeStatus(id, flag) {
        status = flag == 1 ? 0 : 1;
        msgAdd = flag == 1 ? "停用" : "启用";
        if (!confirm("确定"+msgAdd+"吗？"))
            return false;
        $.ajax({
            url		: "[[@{/feedback/typesave}]]",
            data	: {"id":id,"status":status},
            type	: "post",
            dataType: "json",
            success: function (res) {
                console.log(res);
                if(res.code == 200){
                    window.location.reload();
                }else{
                    alert(res.msg);
                }
            }
        });
    }
</script>
</body>
</html>